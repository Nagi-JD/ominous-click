<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧪 Test API - Halloween Clicker</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 900px;
        margin: 20px auto;
        padding: 20px;
        background: #f0f0f0;
      }
      .test-section {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      button {
        background: #000;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        margin: 5px;
        font-size: 14px;
      }
      button:hover {
        background: #333;
      }
      button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
      pre {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
        font-size: 12px;
        max-height: 400px;
        overflow-y: auto;
      }
      .success { color: green; }
      .error { color: red; }
      h2 {
        margin-top: 0;
      }
    </style>
  </head>
  <body>
    <h1>🧪 Test API - Halloween Clicker (Local)</h1>
    
    <div class="test-section">
      <h2>1. Test submit-score to Supabase</h2>
      <p>This will send a test score to your Supabase database</p>
      <button onclick="testSubmit()">🚀 Test Submit Score</button>
      <pre id="submitResult">Click the button to test...</pre>
    </div>
    
    <div class="test-section">
      <h2>2. Test leaderboard from Supabase</h2>
      <p>This will fetch the leaderboard from your Supabase database</p>
      <button onclick="testLeaderboard()">📊 Test Leaderboard</button>
      <pre id="leaderboardResult">Click the button to test...</pre>
    </div>
    
    <div class="test-section">
      <h2>3. Check Supabase Table</h2>
      <p>After testing, check your Supabase dashboard:</p>
      <a href="https://supabase.com/dashboard/project/owmiexqykpbeznftdeey/editor" target="_blank">
        Open Supabase Table Editor →
      </a>
    </div>

    <script>
      const API_URL = 'http://localhost:5173/api'
      
      async function testSubmit() {
        const resultEl = document.getElementById('submitResult')
        resultEl.textContent = '⏳ Testing...'
        
        try {
          const testData = {
            address: 'Test' + Date.now(),
            score: Math.floor(Math.random() * 1000000),
            stats: { 
              damagePerClick: Math.floor(Math.random() * 100), 
              damagePerSecond: Math.floor(Math.random() * 50) 
            }
          }
          
          console.log('Sending:', testData)
          
          const res = await fetch(`${API_URL}/submit-score`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(testData)
          })
          
          console.log('Response status:', res.status)
          
          const data = await res.json()
          console.log('Response data:', data)
          
          resultEl.textContent = `Status: ${res.status}\n\n${JSON.stringify(data, null, 2)}`
          resultEl.className = res.ok ? 'success' : 'error'
          
          if (res.ok) {
            resultEl.textContent += '\n\n✅ Check your Supabase table now!'
          }
        } catch (err) {
          resultEl.textContent = `❌ Error: ${err.message}\n\n${err.stack}`
          resultEl.className = 'error'
        }
      }
      
      async function testLeaderboard() {
        const resultEl = document.getElementById('leaderboardResult')
        resultEl.textContent = '⏳ Fetching...'
        
        try {
          const res = await fetch(`${API_URL}/leaderboard`)
          const data = await res.json()
          
          resultEl.textContent = JSON.stringify(data, null, 2)
          resultEl.className = res.ok ? 'success' : 'error'
          
          if (data.players && data.players.length > 0) {
            resultEl.textContent += `\n\n✅ Found ${data.players.length} players in leaderboard!`
          } else {
            resultEl.textContent += '\n\nℹ️ No players yet. Submit a score first!'
          }
        } catch (err) {
          resultEl.textContent = `❌ Error: ${err.message}\n\n${err.stack}`
          resultEl.className = 'error'
        }
      }
    </script>
  </body>
</html>

